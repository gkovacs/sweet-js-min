'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.expandCompiletime=expandCompiletime,exports.sanitizeReplacementValues=sanitizeReplacementValues,exports.evalCompiletimeValue=evalCompiletimeValue;var _sweetSpec=require('sweet-spec'),S=_interopRequireWildcard(_sweetSpec),_ramda=require('ramda'),_=_interopRequireWildcard(_ramda),_immutable=require('immutable'),_syntax=require('./syntax'),_syntax2=_interopRequireDefault(_syntax),_shiftCodegen=require('shift-codegen'),_shiftCodegen2=_interopRequireDefault(_shiftCodegen),_sweetToShiftReducer=require('./sweet-to-shift-reducer'),_sweetToShiftReducer2=_interopRequireDefault(_sweetToShiftReducer),_termExpander=require('./term-expander'),_termExpander2=_interopRequireDefault(_termExpander),_env=require('./env'),_env2=_interopRequireDefault(_env),_templateProcessor=require('./template-processor');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function expandCompiletime(a,b){let c=new _termExpander2.default(_.merge(b,{phase:b.phase+1,env:new _env2.default,store:b.store}));return c.expand(a)}function sanitizeReplacementValues(a){if(Array.isArray(a))return sanitizeReplacementValues((0,_immutable.List)(a));if(_immutable.List.isList(a))return a.map(sanitizeReplacementValues);if(null==a)throw new Error('replacement values for syntax template must not be null or undefined');else if('function'==typeof a.next)return sanitizeReplacementValues((0,_immutable.List)(a));return a}function evalCompiletimeValue(a,b){let c={syntaxTemplate:function(j,...l){return(0,_templateProcessor.replaceTemplate)(b.templateMap.get(j),sanitizeReplacementValues(l))}},d=(0,_immutable.List)(Object.keys(c)),e=d.map(j=>c[j]).toArray(),f=new S.Module({directives:(0,_immutable.List)(),items:_immutable.List.of(new S.ExpressionStatement({expression:new S.FunctionExpression({isGenerator:!1,name:null,params:new S.FormalParameters({items:d.map(j=>{return new S.BindingIdentifier({name:_syntax2.default.from('identifier',j)})}),rest:null}),body:new S.FunctionBody({directives:_immutable.List.of(new S.Directive({rawValue:'use strict'})),statements:_immutable.List.of(new S.ReturnStatement({expression:a}))})})}))}).reduce(new _sweetToShiftReducer2.default(b.phase)),g=(0,_shiftCodegen2.default)(f,new _shiftCodegen.FormattedCodeGen),h=b.transform(g),i=b.loader.eval(h.code,b.store);return i.apply(void 0,e)}

